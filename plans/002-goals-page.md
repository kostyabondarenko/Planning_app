# План: Страница "Цели"

## Общее описание

Страница для управления целями, их вехами и действиями. Показывает общий прогресс, но не позволяет отмечать выполнение действий (это делается на странице "Ближайшие дни").

---

## Функциональные требования

### 1. Список целей

**Пустое состояние:**
- Кнопка "Добавить цель"

**Есть цели:**
- Список карточек целей
- Каждая карточка: название, период (с — по), прогресс

---

### 2. Цель

**Атрибуты:**
- Название
- Период действия (start_date — end_date)
- Список вех

**Условие закрытия:**
- Цель закрыта, когда закрыты все её вехи

**Просмотр цели (полноэкранный режим):**
- Название и период
- Список вех с их статусами
- Визуализация прогресса (график, кольцо в iOS-стиле)

---

### 3. Веха (Milestone)

**Атрибуты:**
- Название
- Период действия (start_date — end_date)
- Условие закрытия (например, "80% регулярных действий")
- Список действий (регулярные + однократные)

**Валидация:**
- Периоды вех НЕ пересекаются
- Вехи идут последовательно друг за другом

**Условие закрытия:**
- Задаётся при создании вехи
- Пример: "80% регулярных действий выполнено"
- Проверяется при наступлении end_date

**Если условие НЕ выполнено:**
Показать окно с выбором:
1. Закрыть веху как есть (с текущим прогрессом)
2. Продлить веху (изменить end_date)
3. Снизить требуемый процент

---

### 4. Действия

#### 4.1 Регулярное действие
- Название
- Дни недели (пн, вт, ср, чт, пт, сб, вс)
- Повторяется каждую неделю в указанные дни

**Отметка выполнения:**
- НЕ на этой странице
- Отмечается на странице "Ближайшие дни"
- Здесь виден только % выполнения

#### 4.2 Однократное действие (Action)
- Название
- Deadline (конкретная дата)
- Выполняется один раз

---

### 5. UI/UX

**Создание/редактирование цели или вехи:**
- Полноэкранное окно
- Удобный выбор дат
- Форма добавления вех (при создании цели)
- Форма добавления действий (при создании вехи)

**Просмотр существующей цели:**
- Полноэкранный режим
- Список вех
- Визуализация прогресса:
  - Круговая диаграмма (кольцо)
  - График по времени
  - iOS-подобный дизайн

**Просмотр существующей вехи:**
- Полноэкранный режим
- Список действий (регулярные + однократные)
- Процент выполнения
- Визуализация прогресса

---

## Модель данных

### Goal
```
id: UUID
user_id: UUID
title: string
start_date: date
end_date: date
created_at: timestamp
```

### Milestone
```
id: UUID
goal_id: UUID
title: string
start_date: date
end_date: date
completion_condition: string  // например "80%"
completion_percent: int       // требуемый процент (0-100)
created_at: timestamp
```

### RecurringAction
```
id: UUID
milestone_id: UUID
title: string
weekdays: int[]  // [1,3,5] = пн, ср, пт
created_at: timestamp
```

### RecurringActionLog
```
id: UUID
recurring_action_id: UUID
date: date
completed: boolean
```

### OneTimeAction
```
id: UUID
milestone_id: UUID
title: string
deadline: date
completed: boolean
completed_at: timestamp?
created_at: timestamp
```

---

## План реализации

### Этап 1: Backend — Модель данных ✅
- [x] Создать таблицы: Goal, Milestone, RecurringAction, RecurringActionLog, OneTimeAction
- [x] Миграции Alembic
- [x] Pydantic-схемы

### Этап 2: Backend — API ✅
- [x] CRUD для целей
- [x] CRUD для вех (с валидацией периодов)
- [x] CRUD для действий
- [x] Эндпоинт расчёта прогресса

### Этап 3: Frontend — Список целей ✅
- [x] Пустое состояние с кнопкой
- [x] Карточки целей с прогрессом

### Этап 4: Frontend — Создание цели ✅
- [x] Полноэкранная форма
- [x] Выбор дат (date picker)
- [x] Добавление вех inline

### Этап 5: Frontend — Создание вехи ✅
- [x] Полноэкранная форма
- [x] Выбор дат с валидацией
- [x] Условие закрытия (% регулярных действий)
- [x] Добавление действий

### Этап 6: Frontend — Просмотр цели ✅
- [x] Полноэкранный режим
- [x] Список вех
- [x] Визуализация прогресса (кольцо, график)

### Этап 7: Frontend — Просмотр вехи ✅
- [x] Полноэкранный режим
- [x] Список действий
- [x] Процент выполнения

### Этап 8: Логика закрытия вехи ✅
- [x] Проверка условия при end_date
- [x] Окно с выбором действия (закрыть/продлить/снизить)
